---

- name: reload device after XX min without save config
  # Перезагрузка через (количество портов+2) минут, конфиг должeн быть сохранен перед этим
  ios_command:
    commands: "reload in 4\ny"

- name: configure interface GigabitEthernet0/2
  ios_config:
    parents:
      - "interface GigabitEthernet0/2"
    lines:
      - "switchport mode access"
      - no switchport access vlan
      - "switchport port-security"
      - "switchport port-security maximum 2"
      - "switchport port-security maximum 1 vlan"
      - "switchport port-security aging time 5"
      - "switchport port-security aging type inactivity"
      - "switchport port-security aging static"
      - "storm-control broadcast level bps 200k"
      - "storm-control multicast level bps 200k"

- name: configure interface GigabitEthernet0/3
  ios_config:
    parents:
      - "interface GigabitEthernet0/3"
    lines:
      - "switchport mode access"
      - no switchport access vlan
      - "switchport port-security"
      - "switchport port-security maximum 2"
      - "switchport port-security maximum 1 vlan"
      - "switchport port-security aging time 5"
      - "switchport port-security aging type inactivity"
      - "switchport port-security aging static"
      - "storm-control broadcast level bps 200k"
      - "storm-control multicast level bps 200k"
      - "spanning-tree portfast edge"
      - "spanning-tree bpdufilter enable"
    save_when: modified

- name: cancel reload
  ios_command:
    commands: "reload cancel\n"
